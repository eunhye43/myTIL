ğŸš€ Decorator

ë…ë¦½ì ì¸ HTTP í†µì‹  ë•Œë¬¸ì— í˜ì´ì§€ê°€ ë„˜ì–´ê°ˆë•Œ ë§ˆë‹¤ ìƒˆë¡œìš´ ì¸ì¦ì„ í•´ì¤˜ì•¼ í•œë‹¤.
ìƒˆë¡œìš´ í˜ì´ì§€ì—ì„œ ì¸ì¦ì„ í•´ì•¼í•˜ì§€ë§Œ ì¸ì¦ ì½”ë“œê°€ ë§¤ë²ˆ ëª¨ë“  ì½”ë“œì— ë¶™ìœ¼ë©´ ì½”ë“œê°€ ë³µì¡í•´ì§€ê³  ê¸¸ì–´ì§„ë‹¤. 
ì½”ë“œì˜ ê°€ë…ì„±ê³¼ ê°„ê²°í™”ë¥¼ ìœ„í•´ ì¸ì¦ êµ¬í˜„í›„ ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

import jwt

from django.http.response import JsonResponse
<span color="red">hello</span>

from my_settings import SECRET_KEY, ALGORITHM # ë³´ì™„ì„ ìœ„í•´ ë‘ê°€ì§€ë¥¼ ë¹¼ë‘ 
from users.models import User

def login_required(func):
    def wrapper(self, request, *args, **kwargs):
        try:
            access_token = request.headers.get('Authorization', None)
            # í”„ë¡ íŠ¸ê°€ httpìš”ì²­ì—ì„œ í—¤ë”ì— Authorization(keyê°’) í¬í•¨í•´ì„œ (access_tokenì´ valueê°’) ë°±ì—ê²Œ ë³´ëƒ„! 
            # ë°ì½”ë ˆì´í„°í•¨ìˆ˜ëŠ” authorization í—¤ë”ì—ì„œ ê°’ì½ê³ , í† í°ì´ ë§ëŠ”ì§€ í™•ì¸
            # í† í°ì´ ë§ìœ¼ë©´(ìˆìœ¼ë©´), ê·¸ê°’ì„ ë³µí˜¸í™”(decoding)í•´ì„œ ì‚¬ìš©ì id ì½ì–´ë“¤ì´ê³  í•´ë‹¹ ì‚¬ìš©ìì˜ ë¡œê¸´ ì—¬ë¶€ í™•ì¸        
            payload = jwt.decode(access_token, SECRET_KEY, algorithms=ALGORITHM)
            # í† í°ì„ ë””ì½”ë”©í•´ì„œ ë‚˜ì˜¤ê²Œ ë  ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë¥¼ payloadì— ë‹´ëŠ”ë‹¤.
            # ë™ì¼í•œ ì‚¬ìš©ìë¼ë©´ ë°œí–‰í•  ë–„ ë‚˜ì˜¨ í† í°í•˜ê³  ë™ì¼í•œ í† í°ì´ payloadì— ë°˜í™˜ë˜ê² ì§€
            # ë””ì½”ë”©ì‹œ secret_keyì™€ algorithmì€ í† í° ë°œí–‰ì‹œ ë„£ì—ˆë˜ ì •ë³´ì™€ ê°™ì•„ì•¼í•¨!
            user = User.objects.get(id=payload['user_id']
            # í† í° ë””ì½”ë”©í•´ì„œ ì–»ì€ ì‚¬ìš©ì ì •ë³´ì™€ ë§¤ì¹­ë˜ëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ user ë³€ìˆ˜ì— ì €ì¥!
            request.user = user
            # requestê°ì²´ì— userê°ì²´ ë„£ì–´ì£¼ê¸°. (requestê°ì²´ has headers, body, startline)
            # requestê°ì²´ì— ì¶”ê°€ëœ userê°ì²´ëŠ” ê·¸ëŒ€ë¡œ ë°ì½”ë ˆì´í„°ë¥¼ ë¹ ì ¸ë‚˜ì˜¤ëŠ” ìˆœê°„ ì‚¬ë¼ì§€ì§€ì•Šê³  views.pyì— ìˆëŠ” Profileí´ë˜ìŠ¤ì˜ getë§¤ì„œë“œì— ì „í•´ì§„ë‹¤.
        except jwt.DecodeError:
            # ì—†ëŠ” í† í°ê°’ ë“¤ì–´ì˜¤ë©´ DecodeError ì²˜ë¦¬!
            return JsonResponse({"message":"invalid_token"}, status=401)
        except User.DoesNotExist:
            # ì˜ëª»ëœ ìœ ì €ê°€ ë“¤ì–´ì˜¤ë©´ DoesNotExist ì²˜ë¦¬!
            return JsonResponse({"message":"Unknown_user"}, status=400)
        return func(self, request, *args, **kwargs)
    return wrapper
    # ì¡°ê±´ì´ ëª¨ë‘ ë§ì•„ ë–¨ì–´ì§€ë©´ ì‹œì‘ë  ë•Œ ë°›ì€ parameterë¥¼ ì „ë¶€ ë‹¤ ë¦¬í„´,
    # ë§ˆì§€ë§‰ìœ¼ë¡œ wrapperí•¨ìˆ˜ ë¦¬í„´