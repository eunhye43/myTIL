## **🏋️ Load Balancing 🏋️**

> 🥕 **Load Balancing**이란? 
* 하나의 인터넷 서비스가 발생하는 트래픽이 많을 때 여러 대의 서버가 분산처리하여 서버의 로드율 증가, 부하량, 속도저하 등을 고려하여 적절히 분산처리하여 해결해주는 서비스!
> 
* 하드웨어 향상하는 비용보다 서버 한대 추가 비용이 더 적음! 여러 대의 Server 덕분에 무중단 서비스를 제공할 수 있습니다. 여러 대의 Server에게 균등하게 Traffic을 분산시켜주는 역할을 하는 것이 **Load Balancer**.

🥕 Client가 한 두명인 경우에는?
-> Server는 여유롭게 사용자가 원하는 결과를 응답 해줄 수 있다!

🥕 하지만 Client가 한 두명이 아닌 수천만명이라면???
-> Server는 모든 사람들의 응답을 해주려고 노력하지만 결국엔 지치게 되어 동작을 멈추게 될꺼야..ㅠㅠ

![](https://images.velog.io/images/majaeh43/post/d31fb078-23e0-41c0-9ad3-10d5dbc80bdf/image.png)

🥕 그럼 문제를 해결하기 위해서는 어떻게 해야할까?
* Scale-up : Server가 더 빠르게 동작하기 위해 하드웨어 성능을 올리는 방법.
* Scale-out : 하나의 Server 보다는 여러 대의 Server가 나눠서 일을 하는 방법.

![](https://images.velog.io/images/majaeh43/post/6860da11-8669-4bf0-84b0-a3a2a6d236bd/image.png)

🥕 그럼 Scale-out의 장점이 뭘까?
* 하드웨어 향상하는 비용보다 서버 한대 추가 비용이 더 적음!
* 여러 대의 Server 덕분에 무중단 서비스를 제공할 수 있음!

🥕 클라이언트의 요청을 특정 서버에 분배하는 로드밸런싱 기법은 여러 가지가 있다! **활용할 수 있는 부하 분산 방식(로드밸런싱 알고리즘)**에 어떠한 것들이 있는지 알아보자! 

• 라운드로빈 방식(Round Robin Method) 
**서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식**. 클라이언트의 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 갖고 있고, 서버와의 연결(세션)이 오래 지속되지 않는 경우에 활용하기 적합. 

• 가중 라운드로빈 방식(Weighted Round Robin Method) 
각각의 서버마다 가중치를 매기고 **가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분**. 주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 부하 분산 방식. 예를 들어 A라는 서버가 5라는 가중치를 갖고 B라는 서버가 2라는 가중치를 갖는다면, 로드밸런서는 라운드로빈 방식으로 A 서버에 5개 B 서버에 2개의 요청을 전달. 

• IP 해시 방식(IP Hash Method) 
**클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식**입니다. 사용자의 IP를 해싱해(Hashing, 임의의 길이를 지닌 데이터를 고정된 길이의 데이터로 매핑하는 것, 또는 그러한 함수) 로드를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장.

• 최소 연결 방식(Least Connection Method) 
**요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트래픽을 배분**. 자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합한 방식. 

• 최소 리스폰타임(Least Response Time Method) 
서버의 현재 연결 상태와 응답시간(Response Time, 서버에 요청을 보내고 최초 응답을 받을 때까지 소요되는 시간)을 모두 고려하여 트래픽을 배분. **가장 적은 연결 상태와 가장 짧은 응답시간을 보이는 서버에 우선적으로 로드를 배분하는 방식**.

🥕 네트워크 통신 시스템은 크게 일곱가지의 계층(OSI 7 layers! 내가 지난 시간 블로깅할 때 공부한 게 나왔넹...?😇)으로 나뉨!! 각각의 계층(Layer)이 L1/L2/L3‥‥L7에 해당. 상위 계층에서 사용되는 장비는 하위 계층의 장비가 갖고 있는 기능을 모두 가지고 있으며, 상위 계층으로 갈수록 더욱 정교한 로드밸런싱이 가능. 

* **부하 분산에는 L4 로드밸런서와 L7 로드밸런서가 가장 많이 활용됨**. 그 이유는 L4 로드밸런서부터 포트(Port)정보를 바탕으로 로드를 분산하는 것이 가능하기 때문. 한 대의 서버에 각기 다른 포트 번호를 부여하여 다수의 서버 프로그램을 운영하는 경우라면 최소 L4 로드밸런서 이상을 사용해야만 함!

* L4: Transport Layer(IP와 Port) Level에서 Load Balancing.(TCP, UDP)
* L7: Application Layer(사용자의 Request) Level에서 Load Balancing.(HTTP, HTTPS, FTP)

![](https://images.velog.io/images/majaeh43/post/e6fbbbef-754d-45a7-a8e0-98eddc368287/image.png)

![](https://images.velog.io/images/majaeh43/post/2c0bbef7-5d6b-4540-90e8-62df21350be8/image.png)

* L4 로드밸런서는 네트워크 계층(IP, IPX)이나 트랜스포트 계층(TCP, UDP)의 정보를 바탕으로 로드를 분산함. IP주소나 포트번호, MAC주소, 전송 프로토콜에 따라 트래픽을 나누는 것이 가능합니다. 

* 반면, L7 로드밸런서의 경우 애플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산하기 때문에 HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능함. 쉽게 말해 패킷의 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배하는 것이 가능한 것. 위 그림과 같이 URL에 따라 부하를 분산시키거나, HTTP 헤더의 쿠키값에 따라 부하를 분산하는 등 클라이언트의 요청을 보다 세분화해 서버에 전달할 수 있다! 또한, L7 로드밸런서의 경우 특정한 패턴을 지닌 바이러스를 감지해 네트워크를 보호할 수 있으며, DoS/DDoS와 같은 비정상적인 트래픽을 필터링할 수 있어 네트워크 보안 분야에서도 활용되고 있음!

![](https://images.velog.io/images/majaeh43/post/ca28a056-72cc-42f1-8613-e81455f04235/image.png)


출처1: https://m.post.naver.com/viewer/postView.nhn?volumeNo=27046347&memberNo=2521903
출처2: https://nesoy.github.io/articles/2018-06/Load-Balancer
